<!DOCTYPE html>
<html lang="en">
<head>
  <title>Review Order</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4>Review Your Medical Bill</h4>
                </div>
                <div class="card-body">
                    {% if pres.pharmacist_note %}
    <div class="alert alert-warning border-warning shadow-sm mb-4" role="alert">
        <h5 class="text-dark mb-1">
            <i class="icon-comment-o mr-2"></i> <strong>Message from Pharmacist:</strong>
        </h5>
        <p class="mb-0 text-black" style="font-size: 1.1rem;">
            "{{ pres.pharmacist_note }}"
        </p>
    </div>
    {% endif %}
                    <p><strong>Pharmacy:</strong> {{ pres.assigned_pharmacy.name }}</p>


                    <table class="table mt-4">
                        <thead>
                            <tr>
                                <th>Medicine</th>
                                <th>Qty</th>
                                <th>Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                            <tr>
                                <td>{{ item.medicine.name }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>₹{{ item.price_at_time }}</td>
                                <td>₹{{ item.total_price }}</td>
                            </tr>
                            {% endfor %}

                            <!-- Delivery Fee Row -->
                            {% if delivery_fee > 0 %}
                            <tr>
                                <td colspan="3" class="text-right"><strong>Delivery Fee (Home):</strong></td>
                                <td>₹{{ delivery_fee }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" class="text-right"><strong>Store Pickup:</strong></td>
                                <td class="text-success">FREE</td>
                            </tr>
                            {% endif %}

                            <!-- Total Row -->
                            <tr class="bg-light">
                                <td colspan="3" class="text-right"><h5>Grand Total:</h5></td>
                                <td><h5 class="text-primary">₹{{ grand_total }}</h5></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="/my_prescriptions/" class="btn btn-secondary">Cancel / Back</a>

                        <!-- Inside review_prescription.html -->

<form action="{% url 'confirm_prescription_order' pres.id %}" method="POST">
    {% csrf_token %}

    <!-- ADDRESS SECTION -->
    <h5 class="mt-4">Delivery Details</h5>
    <div class="row">
        <div class="col-md-6">
            <input type="text" name="address" class="form-control mb-2" placeholder="Street Address" required>
        </div>
        <div class="col-md-3">
            <input type="text" name="city" class="form-control mb-2" placeholder="City" required>
        </div>
        <div class="col-md-3">
            <input type="text" name="zip" class="form-control mb-2" placeholder="Pincode" required>
        </div>
    </div>

    <!-- PAYMENT SECTION -->
    <h5 class="mt-3">Payment Method</h5>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="payment_mode" value="COD" checked>
        <label class="form-check-label">Cash on Delivery (COD)</label>
    </div>
    <div class="form-check mb-4">
        <input class="form-check-input" type="radio" name="payment_mode" value="Online">
        <label class="form-check-label">Online Payment (Simulated)</label>
    </div>

    <!-- BUTTONS -->
    <div class="d-flex justify-content-between">
        <!-- Reject Link -->
        <a href="{% url 'reject_quote' pres.id %}" class="btn btn-danger" onclick="return confirm('Are you sure you want to decline this quote?');">
            Decline Quote
        </a>

        <!-- Confirm Button -->
        <button type="submit" class="btn btn-success btn-lg">
            Confirm & Place Order
        </button>
    </div>
</form>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>